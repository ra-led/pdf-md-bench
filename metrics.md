# Пояснение метрик

### text_edit_norm_micro
- **Формула**: сумма расстояний редактирования / общее число символов GT (микро). Несопоставленные блоки добавляют свою длину в числитель и знаменатель.
- **Происхождение кода**: локально в `pdf_md_benchmark.py` (не из OmniDocBench).
- **Интерпретация**: меньше — лучше (0 означает идентичный текст).

### text_meteor_micro
- **Формула**: METEOR по каждому блоку (0 для пропусков) и среднее по всем блокам (микро).
- **Код**: локальная упрощённая METEOR, не из OmniDocBench.
- **Интерпретация**: больше — лучше (семантическая близость).

### text_classification_macro_f1
- **Формула**: F1 по классам (параграф/заголовок/список) усредняется поровну.
- **Код**: локальный.
- **Интерпретация**: больше — лучше; показывает сохранение типологии блоков.

### text_classification_micro_f1
- **Формула**: сводные TP/FP/FN по всем классам, затем один F1.
- **Код**: локальный.
- **Интерпретация**: больше — лучше; глобальная точность классификации блоков.

### table_micro_precision / table_micro_recall / table_micro_f1
- **Формула**: детекция таблиц на всём корпусе (TP/FP/FN → precision/recall/F1).
- **Код**: собственный матчинг + вспомогательные функции OmniDocBench для нормализации таблиц.
- **Интерпретация**: больше — лучше; качество распознавания таблиц.

### table_teds_mean_on_matched
- **Формула**: средний TEDS по совпавшим таблицам.
- **Код**: `OmniDocBench.metrics.table_metric.TEDS`.
- **Интерпретация**: больше — лучше; схожесть структуры и текста в таблицах.

### image_micro_precision / image_micro_recall / image_micro_f1
- **Формула**: детекция изображений (микро). TP требуют IoU ≥ порога, FP/FN — несопоставленные боксы.
- **Код**: локальный.
- **Интерпретация**: больше — лучше; качество обнаружения изображений.

### image_desc_cosine_mean_on_matched
- **Формула**: косинусная близость между эмбеддингами RuBERT (fallback на bag-of-words) для описаний совпавших изображений, усреднённая.
- **Код**: локальный.
- **Интерпретация**: больше — лучше; семантическая точность подписей.

### image_desc_applicability
- **Формула**: доля страниц, на которых вообще были совпавшие изображения (покрытие для cosine-score).
- **Код**: локальный.
- **Интерпретация**: больше — лучше; чем выше, тем репрезентативнее среднее значение.

### lists_f1 / headers_f1 / paras_f1
- **Формула**: F1 по каждому типу блоков (списки, заголовки, параграфы).
- **Код**: локальная классификация.
- **Интерпретация**: больше — лучше; указывает, какой тип блоков страдает.

### heading_edge_f1_micro
- **Формула**: глобальные precision/recall/F1 по рёбрам «родитель→дочерний» между заголовками.
- **Код**: локальный (`compute_heading_hierarchy_metrics`).
- **Интерпретация**: больше — лучше; точность реконструкции структуры документа.

## Итоговый SCORE

Можно вычислить сводный SCORE с весами:

| Компонент | Вес | Определение |
| --- | --- | --- |
| E′ (точность текста) | 0.25 | `E′ = 1 - text_edit_norm_micro` |
| M (семантика текста) | 0.25 | `M = text_meteor_micro` |
| C (структура текста) | 0.15 | `C = text_classification_macro_f1` |
| T (таблицы) | 0.20 | `T = table_micro_f1 × table_teds_mean_on_matched` |
| H (иерархия) | 0.10 | `H = heading_edge_f1_micro` |
| I (изображения) | 0.05 | `I = (3 × image_micro_f1 + image_desc_cosine_mean_on_matched) ÷ 4` |
| Итого | 1.00 | `SCORE = 0.25·E′ + 0.25·M + 0.15·C + 0.20·T + 0.10·H + 0.05·I` |

Чем выше SCORE, тем лучше суммарное качество по всем аспектам (текст, семантика, структура, таблицы, иерархия, изображения).
